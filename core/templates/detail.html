{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ROYAL CARS - Car Detail</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="{% static 'img/favicon.ico' %}" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Rubik&display=swap" rel="stylesheet"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <style>
        .owner-info { margin-top: 20px; }
        .owner-card {
            background: #f8f9fa; border-radius: 12px; padding: 20px;
            border: 1px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out;
        }
        .owner-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .owner-card p { margin: 10px 0; font-size: 16px; color: #333; }
        .owner-card strong { color: #007bff; }
        
    </style>
</head>

<body>
    <div class="container-fluid bg-dark py-3 px-lg-5 d-none d-lg-block">
        <div class="row">
            <div class="col-md-6 text-center text-lg-left mb-2 mb-lg-0">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body pr-3" href=""><i class="fa fa-phone-alt mr-2"></i>+012 345 6789</a>
                    <span class="text-body">|</span>
                    <a class="text-body px-3" href=""><i class="fa fa-envelope mr-2"></i>info@example.com</a>
                </div>
            </div>
            <div class="col-md-6 text-center text-lg-right">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body px-3" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-twitter"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-instagram"></i></a>
                    <a class="text-body pl-3" href=""><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Navbar Start -->
        <div class="container-fluid position-relative nav-bar p-0">
  <div class="position-relative px-lg-5" style="z-index: 9;">
    <nav class="navbar navbar-expand-lg bg-secondary navbar-dark py-3 py-lg-0 pl-3 pl-lg-5">
      <a href="/" class="navbar-brand">
        <h1 class="text-uppercase text-primary mb-1">Royal Cars</h1>
      </a>
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-between px-3" id="navbarCollapse">
        <div class="navbar-nav ml-auto py-0">
          <a href="{% url 'index' %}" class="nav-item nav-link">Home</a>
          <a href="{% url 'about' %}" class="nav-item nav-link">About</a>
          <a href="{% url 'service' %}" class="nav-item nav-link">Service</a>
          <a href="{% url 'car' %}" class="nav-item nav-link">Cars</a>
          <a href="{% url 'contact' %}" class="nav-item nav-link">Contact</a>

          {% if user.is_authenticated %}
              {% if user.role == "owner" %}
                  <a href="{% url 'owner_dashboard' %}" class="nav-item nav-link">Dashboard</a>
              {% else %}
                  <a href="{% url 'my_bookings' %}" class="nav-item nav-link">My Bookings</a>
                  <a href="{% url 'profile' %}" class="nav-item nav-link">Profile</a>
              {% endif %}
              <a href="{% url 'logout' %}" class="nav-item nav-link">Logout</a>
          {% else %}
              <a href="{% url 'login' %}" class="nav-item nav-link">Login</a>
              <a href="{% url 'register' %}" class="nav-item nav-link">Register</a>
              <a href="{% url 'register_owner' %}" class="nav-item nav-link">Register as Owner</a>
          {% endif %}
        </div>
      </div>
    </nav>
  </div>
</div>
    <!-- Navbar End -->


    <div class="container-fluid page-header">
        <div class="d-inline-flex text-white">
            <h6 class="text-uppercase m-0"><a class="text-white" href="{% url 'index' %}">Home</a></h6>
            <h6 class="text-body m-0 px-3">/</h6>
            <h6 class="text-uppercase text-body m-0">{{ car.name }}</h6>
        </div>
    </div>

    <div class="container-fluid pt-5">
        <div class="container pt-5">
            <div class="row">
                <div class="col-lg-7 mb-5">
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <!-- ÿµŸàÿ±ÿ© ÿßŸÑÿ≥Ÿäÿßÿ±ÿ© -->
    {% if car.image %}
    <img src="{{ car.image.url }}" class="card-img-top img-fluid" alt="{{ car.name }}" style="object-fit: cover; height: 350px;">
    {% endif %}

    <div class="card-body bg-light">
      <h2 class="card-title text-uppercase fw-bold text-primary mb-3">{{ car.name }}</h2>
      <p class="card-text text-muted">{{ car.description }}</p>

      <hr class="my-4">

      <!-- ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ -->
      <div class="row text-center">
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-calendar-alt text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Year</h6>
            <span class="fw-bold">{{ car.year }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-cogs text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Gear</h6>
            <span class="fw-bold">{{ car.transmission }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-road text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Mileage</h6>
            <span class="fw-bold">{{ car.mileage }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-dollar-sign text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Price</h6>
            <span class="fw-bold" id="price-display">${{ car.price }}/Day</span>
          </div>
        </div>
         <div class="col-12 col-md-6 mx-auto mt-3">
  <div class="border rounded p-4 bg-white shadow-sm text-center">
    <i class="fa fa-money-bill-wave text-primary fs-3 mb-2"></i>
    <h6 class="fw-bold text-dark mb-2">Choose Currency</h6>
    <select id="currency" class="form-select form-select-sm w-50 mx-auto border-primary">
      <option value="usd" selected>USD ($)</option>
      <option value="eur">EUR (‚Ç¨)</option>
      <option value="ils">ILS (‚Ç™)</option>
      <option value="jod">JOD (ÿØ.ÿ£)</option>
    </select>
  </div>
</div>
      </div>
    </div>
  </div>
</div>



                <div class="col-lg-5 mb-5 owner-info">
                    <h3 class="text-uppercase mb-3">Car Owner Information</h3>
                    <div class="owner-card">
                        <p><strong>üë§ Owner:</strong> {{ car.owner.username }}</p>
                        <p><strong>üìß Email:</strong> {{ car.owner.email }}</p>
                        <p><strong>üì± Phone:</strong> {{ car.owner.phone }}</p>
                        <p><strong>üè¢ Company:</strong> <a href="{% url 'owner_cars' car.owner.id %}">{{ car.owner.company_name }}</a></p>
                    </div>
                </div>

                <div class="col-lg-12 mb-5">
                    <div class="bg-secondary p-5 rounded shadow">
                        <h3 class="text-primary text-center mb-4">Book This Car</h3>
                        {% if user.is_authenticated %}
                            {% if user.role != "owner" %}
                        <form id="bookingForm" method="post" action="{% url 'booking' %}">
                            {% csrf_token %}
                            <input type="hidden" name="car" value="{{ car.id }}">
                            <div class="form-group">
                                <input type="text" class="form-control p-4 mb-3" name="pickup_location" placeholder="Pickup Location" required>
                                <input type="text" class="form-control p-4 mb-3" name="drop_location" placeholder="Drop Location" required>
                                <input type="date" class="form-control p-4 mb-3" name="pickup_date" required>
                                <input type="time" class="form-control p-4 mb-3" name="pickup_time" required>
                                <textarea class="form-control p-4 mb-3" name="special_request" placeholder="Special Request (optional)"></textarea>
                            </div>
                            <button class="btn btn-primary btn-block" type="submit">Reserve Now</button>
                        </form>
                        <div id="bookingMessage" class="mt-3"></div>
                        {% else %}
                            <div class="alert alert-warning text-center">
                                ‚ö†Ô∏è Owners cannot make bookings.
                            </div>
                        {% endif %}
                        {% else %}
                        <p class="text-white">‚ö†Ô∏è You must be logged in to book this car.</p>
                        <a href="{% url 'login' %}" class="btn btn-light btn-block">Login to Book</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- footer        //////////////////////   -->
    <div class="container-fluid bg-secondary py-5 px-sm-3 px-md-5" style="margin-top: 90px;">
        <div class="row pt-5">
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Get In Touch</h4>
                <p class="mb-2"><i class="fa fa-map-marker-alt text-white mr-3"></i>123 Street, New York, USA</p>
                <p class="mb-2"><i class="fa fa-phone-alt text-white mr-3"></i>+012 345 67890</p>
                <p><i class="fa fa-envelope text-white mr-3"></i>info@example.com</p>
                <h6 class="text-uppercase text-white py-2">Follow Us</h6>
                <div class="d-flex justify-content-start">
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square" href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Useful Links</h4>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Private Policy</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Terms & Conditions</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>New Member Registration</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Affiliate Programme</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Return & Refund</a>
                    <a class="text-body" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Help & FAQs</a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Car Gallery</h4>
                <div class="row mx-n1">
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-1.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-2.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-3.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-4.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-5.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-6.jpg' %}" alt=""></a></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Newsletter</h4>
                <p class="mb-4">Subscribe to get the latest updates and offers.</p>
                <div class="w-100 mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control bg-dark border-dark" style="padding: 25px;" placeholder="Your Email">
                        <div class="input-group-append">
                            <button class="btn btn-primary text-uppercase px-3">Sign Up</button>
                        </div>
                    </div>
                </div>
                <i>Lorem sit sed elitr sed kasd et</i>
            </div>
        </div>
    </div>

    <div class="container-fluid bg-dark py-4 px-sm-3 px-md-5">
        <p class="mb-2 text-center text-body">&copy; <a href="#">Royal Cars</a>. All Rights Reserved.</p>
        <p class="m-0 text-center text-body">Designed by <a href="https://htmlcodex.com">A&M Group</a></p>
    </div>

    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
    
    <!-- end footer        ////////////////////// -->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function() {
    console.log("‚úÖ jQuery ready, script loaded!"); // ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸá ŸäÿπŸÖŸÑ

    $("#bookingForm").on("submit", function(e) {
        e.preventDefault(); // ŸäŸÖŸÜÿπ ÿßŸÑŸÅŸàÿ±ŸÖ ŸÖŸÜ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿ¨ÿØŸäÿØÿ©
        console.log("üì§ Form submit intercepted!");

        const form = $(this);

        $.ajax({
            type: "POST",
            url: form.attr("action"),
            data: form.serialize(),
            dataType: "json",
            beforeSend: function() {
                $("#bookingMessage").html(`
                    <div class="alert alert-info text-center">‚è≥ Processing your booking...</div>
                `);
            },
            success: function(response) {
                console.log("‚úÖ Ajax success:", response);
                $("#bookingMessage").html(`
                    <div class="alert alert-success text-center">
                        ‚úÖ ${response.message}
                    </div>
                `);
                form.trigger("reset");
            },
            error: function(xhr, status, error) {
                console.log("‚ùå Ajax error:", error);
                $("#bookingMessage").html(`
                    <div class="alert alert-danger text-center">
                        ‚ùå Something went wrong. Please try again.
                    </div>
                `);
            }
        });
    });
});
document.addEventListener("DOMContentLoaded", function() {
  const priceUSD = parseFloat('{{ car.price }}');
  const priceDisplay = document.getElementById("price-display");
  const currencySelect = document.getElementById("currency");

  currencySelect.addEventListener("change", async function() {
    const currency = this.value.toUpperCase();

    try {
      // 1Ô∏è‚É£ ÿ¨ŸÑÿ® ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖŸÜ API ÿπÿßŸÖ
      const response = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
      const data = await response.json();

      // 2Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿπŸÖŸÑÿ© ŸÖŸàÿ¨ŸàÿØÿ© ŸÅÿπŸÑÿßŸã
      if (!data.rates[currency]) {
        priceDisplay.innerText = "$" + priceUSD.toFixed(2);
        return;
      }

      // 3Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸä
      const rate = data.rates[currency];
      const convertedPrice = (priceUSD * rate).toFixed(2);
      const symbolMap = { USD: "$", EUR: "‚Ç¨", ILS: "‚Ç™", JOD: "ÿØ.ÿ£" };
      const symbol = symbolMap[currency] || currency;

      // 4Ô∏è‚É£ ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ¨ÿØŸäÿØ ŸÖÿπ ÿ≠ÿ±ŸÉÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©
      priceDisplay.style.opacity = 0;
      setTimeout(() => {
        priceDisplay.innerText = `${symbol}${convertedPrice}`;
        priceDisplay.style.opacity = 1;
      }, 100);
      priceDisplay.classList.add("text-primary");
      setTimeout(() => priceDisplay.classList.remove("text-primary"), 500);
      
    } catch (error) {
      console.error("Error fetching exchange rate:", error);
      priceDisplay.innerText = "$" + priceUSD.toFixed(2);
    }
  });
});

</script>


    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>