{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ROYAL CARS - Car Detail</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="{% static 'img/favicon.ico' %}" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Rubik&display=swap" rel="stylesheet"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <style>
        .owner-info { margin-top: 20px; }
        .owner-card {
            background: #f8f9fa; border-radius: 12px; padding: 20px;
            border: 1px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out;
        }
        .owner-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .owner-card p { margin: 10px 0; font-size: 16px; color: #333; }
        .owner-card strong { color: #007bff; }
        #currency {
            transition: all 0.3s ease;
            background-color: #fff;
            }
            .fixed-reserve-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ff7b00;
            border: none;
            color: white;
            border-radius: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 1050;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            }

            /* ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿ≥Ÿäÿ∑ ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ± */
            .fixed-reserve-btn:hover {
            background-color: #e66e00;
            box-shadow: 0 8px 20px rgba(255, 123, 0, 0.4);
            transform: translateX(-50%) scale(1.02);
            }
            #currency + .fa-exchange-alt {
  margin-left: 10px; /* ÿßŸÑŸÖÿ≥ÿßŸÅÿ© ÿ®ŸäŸÜ ÿßŸÑÿ≥ŸÑŸÉÿ™ ŸàÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© */
}
    </style>
</head>

<body>
    <div class="container-fluid bg-dark py-3 px-lg-5 d-none d-lg-block">
        <div class="row">
            <div class="col-md-6 text-center text-lg-left mb-2 mb-lg-0">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body pr-3" href=""><i class="fa fa-phone-alt mr-2"></i>+012 345 6789</a>
                    <span class="text-body">|</span>
                    <a class="text-body px-3" href=""><i class="fa fa-envelope mr-2"></i>info@example.com</a>
                </div>
            </div>
            <div class="col-md-6 text-center text-lg-right">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body px-3" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-twitter"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-body px-3" href=""><i class="fab fa-instagram"></i></a>
                    <a class="text-body pl-3" href=""><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Navbar Start -->
        <div class="container-fluid position-relative nav-bar p-0">
  <div class="position-relative px-lg-5" style="z-index: 9;">
    <nav class="navbar navbar-expand-lg bg-secondary navbar-dark py-3 py-lg-0 pl-3 pl-lg-5">
      <a href="/" class="navbar-brand">
        <h1 class="text-uppercase text-primary mb-1">Royal Cars</h1>
      </a>
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-between px-3" id="navbarCollapse">
        <div class="navbar-nav ml-auto py-0">
          <a href="{% url 'index' %}" class="nav-item nav-link">Home</a>
          <a href="{% url 'about' %}" class="nav-item nav-link">About</a>
          <a href="{% url 'service' %}" class="nav-item nav-link">Service</a>
          <a href="{% url 'car' %}" class="nav-item nav-link">Cars</a>
          <a href="{% url 'contact' %}" class="nav-item nav-link">Contact</a>

          {% if user.is_authenticated %}
              {% if user.role == "owner" %}
                  <a href="{% url 'owner_dashboard' %}" class="nav-item nav-link">Dashboard</a>
              {% else %}
                  <a href="{% url 'my_bookings' %}" class="nav-item nav-link">My Bookings</a>
                  <a href="{% url 'profile' %}" class="nav-item nav-link">Profile</a>
              {% endif %}
              <a href="{% url 'logout' %}" class="nav-item nav-link">Logout</a>
          {% else %}
              <a href="{% url 'login' %}" class="nav-item nav-link">Login</a>
              <a href="{% url 'register' %}" class="nav-item nav-link">Register</a>
              <a href="{% url 'register_owner' %}" class="nav-item nav-link">Register as Owner</a>
          {% endif %}
        </div>
      </div>
    </nav>
  </div>
</div>
    <!-- Navbar End -->


    <div class="container-fluid page-header">
        <div class="d-inline-flex text-white">
            <h6 class="text-uppercase m-0"><a class="text-white" href="{% url 'index' %}">Home</a></h6>
            <h6 class="text-body m-0 px-3">/</h6>
            <h6 class="text-uppercase text-body m-0">{{ car.name }}</h6>
        </div>
    </div>

    <div class="container-fluid pt-5">
        <div class="container pt-5">
            <div class="row">
                <div class="col-lg-7 mb-5">
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <!-- ÿµŸàÿ±ÿ© ÿßŸÑÿ≥Ÿäÿßÿ±ÿ© -->
    {% if car.image %}
    <img src="{{ car.image.url }}" class="card-img-top img-fluid" alt="{{ car.name }}" style="object-fit: cover; height: 350px;">
    {% endif %}

    <div class="card-body bg-light">
      <h2 class="card-title text-uppercase fw-bold text-primary mb-3">{{ car.name }}</h2>
      <p class="card-text text-muted">{{ car.description }}</p>

      <hr class="my-4">

      <!-- ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ -->
      <div class="row text-center">
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-calendar-alt text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Year</h6>
            <span class="fw-bold">{{ car.year }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-cogs text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Gear</h6>
            <span class="fw-bold">{{ car.transmission }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-road text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Mileage</h6>
            <span class="fw-bold">{{ car.mileage }}</span>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="p-2">
            <i class="fa fa-dollar-sign text-primary fs-4 mb-1"></i>
            <h6 class="fw-semibold text-secondary mb-0">Price</h6>
            <span class="fw-bold" id="price-display">${{ car.price }}/Day</span>
          </div>
        </div>
 <div class="col-12 col-md-8 mx-auto mt-4">
  <div class="border rounded-4 p-4 bg-light shadow-sm text-center">
    <div class="d-flex flex-column align-items-center">
      <i class="fa fa-money-bill-wave text-success fs-3 mb-2"></i>
      <h6 class="fw-bold text-dark mb-3">Select Your Currency</h6>

      <div class="d-flex justify-content-center align-items-center gap-4">
        <select id="currency" 
                class="form-select form-select-sm border-2 fw-semibold text-center" 
                style="width: 180px; border-color: #ff7b00; border-radius: 12px; color: #333;">
          <option value="usd" selected>USD ($)</option>
          <option value="eur">EUR (‚Ç¨)</option>
          <option value="ils">ILS (‚Ç™)</option>
          <option value="jod">JOD (ÿØ.ÿ£)</option>
        </select>
        <i class="fa fa-exchange-alt text-warning fs-5"></i>
      </div>
    </div>
  </div>
</div>

<!-- üüß ÿ≤ÿ± ÿßŸÑÿ≠ÿ¨ÿ≤ -->
<!-- <div class="d-flex justify-content-center mt-4 mb-3">
  <a href="#bookingForm" 
     class="btn btn-lg px-5 py-2 fw-semibold shadow scroll-btn fixed-reserve-btn"
     style="background-color: #ff7b00; border-radius: 30px; color: white; transition: all 0.3s ease;">
    <i class="fa fa-calendar-check me-2"></i> Reserve This Car
  </a>
</div> -->

      </div>
    </div>
  </div>
</div>


        <div class="col-lg-5 mb-5 owner-info">

            <!-- üßç‚Äç‚ôÇÔ∏è Owner Info -->
            <div class="mb-5">
                <h3 class="text-uppercase mb-3 text-primary fw-bold border-bottom pb-2">
                <i class="fa fa-user me-2"></i> Car Owner Information
                </h3>

                <div class="owner-card bg-white border rounded-4 shadow-sm p-4">
                <div class="mb-3">
                    <p class="mb-2"><i class="fa fa-user text-primary me-2"></i><strong> Owner:</strong> {{ car.owner.username }}</p>
                    <p class="mb-2"><i class="fa fa-envelope text-primary me-2"></i><strong> Email:</strong> {{ car.owner.email }}</p>
                    <p class="mb-2"><i class="fa fa-phone text-primary me-2"></i><strong> Phone:</strong> {{ car.owner.phone }}</p>
                    <p class="mb-0"><i class="fa fa-building text-primary me-2"></i><strong> Company:</strong> 
                    <a href="{% url 'owner_cars' car.owner.id %}" class="text-decoration-none fw-semibold text-warning">
                        {{ car.owner.company_name }}
                    </a>
                    </p>
                </div>
                </div>
            </div>

            <!-- üí¨ Customer Reviews -->
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-top-4">
                <h5 class="mb-0"><i class="fa fa-comments me-2"></i>Customer Reviews</h5>
                {% if count_reviews > 0 %}
                    <small class="text-white-50">
                    ‚≠ê {{ avg_rating }} ({{ count_reviews }} Review{% if count_reviews != 1 %}s{% endif %})
                    </small>
                {% endif %}
                </div>

                <div class="card-body bg-light" style="max-height: 320px; overflow-y: auto;">
                {% if reviews %}
                    {% for review in reviews %}
                    <div class="p-3 mb-3 bg-white rounded shadow-sm border-start border-3 border-primary">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong class="text-dark">{{ review.user.username }}</strong>
                        <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
                    </div>

                    <div class="mb-1">
                        <span class="text-warning">
                        {% for i in "12345"|slice:":review.rating"|make_list %}‚òÖ{% endfor %}
                        {% for i in "12345"|slice:"review.rating:"|make_list %}‚òÜ{% endfor %}
                        </span>
                    </div>

                    <p class="mb-0 text-secondary">{{ review.comment }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center text-muted py-4">
                    <i class="fa fa-info-circle me-1"></i> No reviews yet for this car.
                    </div>
                {% endif %}
                </div>
            </div>

            </div>

                

                <div class="col-lg-12 mb-5">
                    <div class="bg-secondary p-5 rounded shadow">
                        <h3 class="text-primary text-center mb-4">Book This Car</h3>
                        {% if user.is_authenticated %}
                            {% if user.role != "owner" %}
                        <form id="bookingForm" method="post" action="{% url 'booking' %}">
                            {% csrf_token %}
                            <input type="hidden" name="car" value="{{ car.id }}">
                            <div class="form-group">
                                <input type="text" class="form-control p-4 mb-3" name="pickup_location" placeholder="Pickup Location" required>
                                <input type="text" class="form-control p-4 mb-3" name="drop_location" placeholder="Drop Location" required>

                                <!-- ‚úÖ ÿ™ÿßÿ±ŸäÿÆ ŸàŸàŸÇÿ™ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ -->
                                <label class="text-white">Pickup Date & Time</label>
                                <input type="date" class="form-control p-4 mb-3" name="pickup_date" required>
                                <input type="time" class="form-control p-4 mb-3" name="pickup_time" required>

                                <!-- ‚úÖ ÿ™ÿßÿ±ŸäÿÆ ŸàŸàŸÇÿ™ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ¨ÿØŸäÿØŸäŸÜ -->
                                <label class="text-white">Return Date & Time</label>
                                <input type="date" class="form-control p-4 mb-3" name="return_date" required>
                                <input type="time" class="form-control p-4 mb-3" name="return_time" required>

                                <textarea class="form-control p-4 mb-3" name="special_request" placeholder="Special Request (optional)"></textarea>
                            </div>
                            <button class="btn btn-primary btn-block" type="submit">Reserve Now</button>
                        </form>
                        <div id="bookingMessage" class="mt-3"></div>
                        {% else %}
                            <div class="alert alert-warning text-center">
                                ‚ö†Ô∏è Owners cannot make bookings.
                            </div>
                        {% endif %}
                        {% else %}
                        <p class="text-white">‚ö†Ô∏è You must be logged in to book this car.</p>
                        <a href="{% url 'login' %}" class="btn btn-light btn-block">Login to Book</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- üî∏ ÿ≤ÿ± ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑÿ´ÿßÿ®ÿ™ -->
<a href="#bookingForm" 
   id="reserveBtn"
   class="btn btn-lg px-5 py-2 fw-semibold shadow scroll-btn fixed-reserve-btn">
  <i class="fa fa-calendar-check me-2"></i> Reserve This Car
</a>
    <!-- footer        //////////////////////   -->
    <div class="container-fluid bg-secondary py-5 px-sm-3 px-md-5" style="margin-top: 90px;">
        <div class="row pt-5">
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Get In Touch</h4>
                <p class="mb-2"><i class="fa fa-map-marker-alt text-white mr-3"></i>123 Street, New York, USA</p>
                <p class="mb-2"><i class="fa fa-phone-alt text-white mr-3"></i>+012 345 67890</p>
                <p><i class="fa fa-envelope text-white mr-3"></i>info@example.com</p>
                <h6 class="text-uppercase text-white py-2">Follow Us</h6>
                <div class="d-flex justify-content-start">
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="#"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-lg btn-dark btn-lg-square" href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Useful Links</h4>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Private Policy</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Terms & Conditions</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>New Member Registration</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Affiliate Programme</a>
                    <a class="text-body mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Return & Refund</a>
                    <a class="text-body" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Help & FAQs</a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Car Gallery</h4>
                <div class="row mx-n1">
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-1.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-2.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-3.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-4.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-5.jpg' %}" alt=""></a></div>
                    <div class="col-4 px-1 mb-2"><a href="#"><img class="w-100" src="{% static 'img/gallery-6.jpg' %}" alt=""></a></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h4 class="text-uppercase text-light mb-4">Newsletter</h4>
                <p class="mb-4">Subscribe to get the latest updates and offers.</p>
                <div class="w-100 mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control bg-dark border-dark" style="padding: 25px;" placeholder="Your Email">
                        <div class="input-group-append">
                            <button class="btn btn-primary text-uppercase px-3">Sign Up</button>
                        </div>
                    </div>
                </div>
                <i>Lorem sit sed elitr sed kasd et</i>
            </div>
        </div>
    </div>

    <div class="container-fluid bg-dark py-4 px-sm-3 px-md-5">
        <p class="mb-2 text-center text-body">&copy; <a href="#">Royal Cars</a>. All Rights Reserved.</p>
        <p class="m-0 text-center text-body">Designed by <a href="https://htmlcodex.com">A&M Group</a></p>
    </div>

    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
    
    <!-- end footer        ////////////////////// -->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>$(document).ready(function() {
    console.log("‚úÖ jQuery ready, script loaded!");

    const pickupDateInput = $('input[name="pickup_date"]');
    const returnDateInput = $('input[name="return_date"]');
    const returnTimeInput = $('input[name="return_time"]');

    
    // ‚úÖ NEW: ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ŸÅŸä ŸÉŸÑ ÿßŸÑÿ≠ŸÇŸàŸÑ
    const today = new Date().toISOString().split("T")[0];
    pickupDateInput.attr("min", today);
    returnDateInput.attr("min", today);

    // ‚úÖ ÿ£ŸàŸÑÿßŸã: ŸÖŸÜÿπ ÿßÿÆÿ™Ÿäÿßÿ± return_date ŸÇÿ®ŸÑ pickup_date
    pickupDateInput.on("change", function() {
        const pickupDate = $(this).val();
        returnDateInput.attr("min", pickupDate); // Ÿäÿ≠ÿØÿØ ÿ£ŸÇŸÑ ÿ™ÿßÿ±ŸäÿÆ ŸÖŸÖŸÉŸÜ ŸÑŸÑÿ•ÿ±ÿ¨ÿßÿπ

        // ÿ•ÿ∞ÿß ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ ÿ£ÿµÿ∫ÿ± ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖÿå ŸäŸÖÿ≥ÿ≠Ÿá
        if (returnDateInput.val() && returnDateInput.val() < pickupDate) {
            returnDateInput.val("");
            returnTimeInput.val("");
        }
    });

    // ‚úÖ üü® ÿ´ÿßŸÜŸäÿßŸã: ÿßŸÑŸÉŸàÿØ ÿßŸÑÿ¨ÿØŸäÿØ ÿ™ÿ®ÿπ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ± (ÿ∂ŸäŸÅŸá ŸáŸÜÿß)
    returnDateInput.on("focus", function() {
        if (!pickupDateInput.val()) {
            $("#bookingMessage").html(`
                <div class="alert alert-warning text-center">
                    ‚ö†Ô∏è Please select the pickup date first.
                </div>
            `);
            pickupDateInput.focus();
            return false; // ŸäŸÖŸÜÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÜ ŸÅÿ™ÿ≠ ÿßŸÑÿ™ŸÇŸàŸäŸÖ ŸÇÿ®ŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ®ÿØÿßŸäÿ©
        }
    });
    // ‚úÖ ÿ´ÿßŸÜŸäÿßŸã: ÿ•ÿ∏Ÿáÿßÿ± return_time ŸÅŸÇÿ∑ ÿ®ÿπÿØ ÿßÿÆÿ™Ÿäÿßÿ± return_date
    returnDateInput.on("change", function() {
        if ($(this).val()) {
            returnTimeInput.closest(".form-control").show();
        } else {
            returnTimeInput.closest(".form-control").hide();
        }
    });

    // ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ© ŸÜÿÆŸÅŸä return_time ŸÑŸäŸÜ ŸäÿÆÿ™ÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ return_date
    returnTimeInput.closest(".form-control").hide();

    // ‚úÖ ÿ´ÿßŸÑÿ´ÿßŸã: ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÅŸàÿ±ŸÖ ÿ®ŸÄ AJAX
    $("#bookingForm").on("submit", function(e) {
        e.preventDefault(); // ŸäŸÖŸÜÿπ ÿßŸÑŸÅŸàÿ±ŸÖ ŸÖŸÜ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿ¨ÿØŸäÿØÿ©
        console.log("üì§ Form submit intercepted!");

        const form = $(this);
        const pickupDate = pickupDateInput.val();
        const returnDate = returnDateInput.val();

        // ÿ™ÿ≠ŸÇŸÇ ÿ®ÿ≥Ÿäÿ∑ ŸÖŸÜ ÿ£ŸÜ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ ÿ®ÿπÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ (ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ŸÑŸÑÿ≥Ÿäÿ±ŸÅÿ±)
        const today = new Date().toISOString().split("T")[0];
        if (pickupDate < today) {
            $("#bookingMessage").html(`
                <div class="alert alert-warning text-center">
                    ‚ö†Ô∏è Pickup date cannot be in the past.
                </div>
            `);
            return;
        }
        if (returnDate < pickupDate) {
            $("#bookingMessage").html(`
                <div class="alert alert-warning text-center">
                    ‚ö†Ô∏è Return date must be after pickup date.
                </div>
            `);
            return;
        }

        $.ajax({
            type: "POST",
            url: form.attr("action"),
            data: form.serialize(),
            dataType: "json",
            beforeSend: function() {
                $("#bookingMessage").html(`
                    <div class="alert alert-info text-center">‚è≥ Processing your booking...</div>
                `);
            },
            success: function(response) {
                console.log("‚úÖ Ajax success:", response);
                $("#bookingMessage").html(`
                    <div class="alert alert-success text-center">
                        ‚úÖ ${response.message}
                    </div>
                `);
                form.trigger("reset");
                returnTimeInput.closest(".form-control").hide(); // ŸäÿÆŸÅŸä ŸàŸÇÿ™ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ ÿ®ÿπÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ
            },
            error: function(xhr, status, error) {
                console.log(" Ajax error:", error);

                // ŸÜÿ≠ÿßŸàŸÑ ŸÜŸÇÿ±ÿ£ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ ÿßŸÑŸÑŸä ÿ±ÿ¨ÿπŸáÿß Django
                let errMsg = " Something went wrong. Please try again.";
                try {
                    const response = JSON.parse(xhr.responseText);
                    if (response.message) {
                        errMsg = ` ${response.message}`;
                    }
                } catch (e) {
                    console.warn("Response not JSON:", xhr.responseText);
                }

                $("#bookingMessage").html(`
                    <div class="alert alert-danger text-center">
                        ${errMsg}
                    </div>
                `);
            }
        });
    });
});
document.addEventListener("DOMContentLoaded", function() {
  const priceUSD = parseFloat('{{ car.price }}');
  const priceDisplay = document.getElementById("price-display");
  const currencySelect = document.getElementById("currency");

  currencySelect.addEventListener("change", async function() {
    const currency = this.value.toUpperCase();

    try {
      // 1Ô∏è‚É£ ÿ¨ŸÑÿ® ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖŸÜ API ÿπÿßŸÖ
      const response = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
      const data = await response.json();

      // 2Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿπŸÖŸÑÿ© ŸÖŸàÿ¨ŸàÿØÿ© ŸÅÿπŸÑÿßŸã
      if (!data.rates[currency]) {
        priceDisplay.innerText = "$" + priceUSD.toFixed(2);
        return;
      }

      // 3Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸä
      const rate = data.rates[currency];
      const convertedPrice = (priceUSD * rate).toFixed(2);
      const symbolMap = { USD: "$", EUR: "‚Ç¨", ILS: "‚Ç™", JOD: "ÿØ.ÿ£" };
      const symbol = symbolMap[currency] || currency;

      // 4Ô∏è‚É£ ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ¨ÿØŸäÿØ ŸÖÿπ ÿ≠ÿ±ŸÉÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©
      priceDisplay.style.opacity = 0;
      setTimeout(() => {
        priceDisplay.innerText = `${symbol}${convertedPrice}`;
        priceDisplay.style.opacity = 1;
      }, 100);
      priceDisplay.classList.add("text-primary");
      setTimeout(() => priceDisplay.classList.remove("text-primary"), 500);
      
    } catch (error) {
      console.error("Error fetching exchange rate:", error);
      priceDisplay.innerText = "$" + priceUSD.toFixed(2);
    }
  });
});

   const reserveBtn = document.getElementById("reserveBtn");
  const bookingForm = document.getElementById("bookingForm");

  // ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÜÿ≤ŸàŸÑ ÿßŸÑŸÜÿßÿπŸÖÿ©
  reserveBtn.addEventListener("click", function (e) {
    e.preventDefault();
    bookingForm.scrollIntoView({
      behavior: "smooth",
      block: "start"
    });
  });

  // ŸÖÿ±ÿßŸÇÿ®ÿ© ŸÖÿ™Ÿâ Ÿäÿ∏Ÿáÿ± ÿßŸÑŸÅŸàÿ±ŸÖ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // ‚úÖ ÿ•ÿ∞ÿß ŸàÿµŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑŸÅŸàÿ±ŸÖ ‚Üí ÿßÿÆŸÅŸä ÿßŸÑÿ≤ÿ±
          reserveBtn.style.opacity = "0";
          reserveBtn.style.pointerEvents = "none";
          reserveBtn.style.transition = "opacity 0.6s ease";
        } else {
          // üîÅ ÿ•ÿ∞ÿß ÿ∑ŸÑÿπ ŸÅŸàŸÇ ÿßŸÑŸÅŸàÿ±ŸÖ ‚Üí ÿ±ÿ¨Ÿëÿπ ÿßŸÑÿ≤ÿ±
          reserveBtn.style.opacity = "1";
          reserveBtn.style.pointerEvents = "auto";
        }
      });
    },
    { threshold: 0.3 } // ÿßŸÑŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÑŸä ÿ™ÿπÿ™ÿ®ÿ± ÿßŸÑŸÅŸàÿ±ŸÖ ÿ∏ÿßŸáÿ± (30%)
  );

  observer.observe(bookingForm);
</script>


    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>